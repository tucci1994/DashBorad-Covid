<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <!-- link css -->
    <link rel="stylesheet" href="style.css">

    <!-- font-awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- google fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Electrolize&display=swap" rel="stylesheet">
    <title>Hello, world!</title>
</head>
<body>


    <div class="modal-custom">
        <div class="modal-custom-content"></div>
    </div>

    <div class="container py-5">
        <div class="row">
            <div class="col-12 col-md-6 text-center text-md-start">
                <p class="h2">
                    Dati Aggiornati al : <span id="data"></span>
                </p>
            </div>
            <div class="col-12 col-md-6 d-flex justify-content-md-end justify-content-center my-3 my-md-0">
              <button id="pieTrigger" class="btn btn-circle me-5"><i class="fas fa-chart-pie text-main"></i></button>
              <button id="mapTrigger" class="btn btn-circle"><i class="fas fa-globe-europe text-main"></i></button>
            </div>
        </div>
    </div>

    <div class="container py-5">
        <div class="row">
            <div class="col-12 col-md-3 mb-3">
                <div class="card-custom d-flex flex-column h-100" data-trend="totale_casi">
                    <p class="h4 mb-5">Casi Totali</p>
                    <p id="totalCases" class="h2 mb-0 text-end text-main mt-auto"></p>
                </div>
            </div>
            <div class="col-12 col-md-3 mb-3" data-trend="dimessi_guariti">
                <div class="card-custom d-flex flex-column h-100">
                    <p class="h4 mb-5">Guariti Totali</p>
                    <p id="totalRecovered" class="h2 mb-0 text-end text-main mt-auto"></p>
                </div>
            </div>
            <div class="col-12 col-md-3 mb-3" data-trend="deceduti">
                <div class="card-custom d-flex flex-column h-100">
                    <p class="h4 mb-5">Morti Totali</p>
                    <p id="totalDeath" class="h2 mb-0 text-end text-main mt-auto"></p>
                </div>
            </div>
            <div class="col-12 col-md-3 mb-3" data-trend="totale_positivi">
                <div class="card-custom d-flex flex-column h-100">
                    <p class="h4 mb-5">Positivi</p>
                    <p id="totalPositive" class="h2 mb-0 text-end text-main mt-auto">123</p>
                </div>
            </div>
        </div>
    </div>

    <div class="container py-5">
        <div class="row">
            <div class="col-12 col-lg-6 scrollable">
                <div id="cardWrapper" class="row p-3">
                </div>
            </div>
            <div class="col-12 col-lg-6 scrollable">
                <div id="progressWrapper" class="row p-3">
                </div>
            </div>
        </div>
    </div>


    <script src="main.js"></script>

    <script>
        fetch('https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-json/dpc-covid19-ita-regioni.json').then(response => response.json())
        .then(dati => {
            // lista id per regione
            let look = {
                            "Abruzzo" : "AB",
                            "Basilicata" : "BA",
                            "Calabria" : "CL",
                            "Campania" : "CA",
                            "Emilia-Romagna" : "EM",
                            "Friuli Venezia Giulia" : "FR",
                            "Lazio" : "LA",
                            "Liguria" : "LI",
                            "Lombardia" :"LO",
                            "Marche" : "MA",
                            "Molise" : "MO",
                            "P.A. Bolzano" : "PB",
                            "P.A. Trento" : "PT",
                            "Piemonte" : "PI",
                            "Puglia" : "PU",
                            "Sardegna" : "SA",
                            "Sicilia" : "SI",
                            "Toscana" : "TO",
                            "Umbria" : "UM",
                            "Valle d'Aosta" : "VA",
                            "Veneto" : "VE"
                        }
            // elementi modale
            let modal = document.querySelector('.modal-custom')
            let modalContent = document.querySelector('.modal-custom-content')
            // Ordinodati piÃ¹ recenti per primi
            let sorted = dati.reverse().map(el => {
                el.code = look[el.denominazione_regione]
                return el
            })
            // Ultima data caricata
            let lastUpdated = sorted[0].data
            // Formattazione per la data di ultimo update
            let lastUpdatedFormatted = lastUpdated.split("T")[0].split("-").reverse().join("/")
            document.querySelector('#data').innerHTML = lastUpdatedFormatted
            // variabile con array in ordine in base al numero di nuovi positivi
            let lastUpdatedData = sorted.filter(el => el.data == lastUpdated).sort( (a , b) => b.nuovi_positivi - a.nuovi_positivi)
            // numero totale di nuovi casi in tutte le regioni
            let totalCases = lastUpdatedData.map(el => el.totale_casi).reduce((t , n) => t + n)
            document.querySelector('#totalCases').innerHTML = totalCases;
            //modale per numeri totali covid della nazione
            let days = Array.from(new Set(sorted.map(el => el.data)))
            document.querySelectorAll('[data-trend]').forEach(el => {
                el.addEventListener('click' , () =>{
                    let set = el.dataset.trend
                    let totalsForDays = days.map(el => [el ,sorted.filter( i => i.data == el).map(e => e[set]).reduce((t,n) => t + n)])
                    let maxData = Math.max(...totalsForDays.map(el => el[1]));
                    modal.classList.add('active')
                    modalContent.innerHTML =
                            `<div class="container my-5 py-5">
                                    <div class="row margin-custom">
                                        <div class="col-12">
                                            <p class="h3 text-main">${set.replace(/_/g," ").toUpperCase()}</p>
                                        </div>
                                        <div class="col-12">
                                            <div id="totalTrend" class="d-flex align-items-end plot">
                                            </div>
                                        </div>
                                    </div>
                                </div>`

                            document.querySelector('#totalTrend')
                            totalsForDays.forEach(el => {
                                let col = document.createElement('div')
                                col.classList.add('d-inline-block' , 'pin-new')
                                col.style.height = `${70 * el[1] / maxData}%`
                                totalTrend.appendChild(col)
                            })
                })
             })

             // numero di totali guariti in tutte le regioni
            let totalRecovered = lastUpdatedData.map(el => el.dimessi_guariti).reduce((t , n) => t + n)
            document.querySelector('#totalRecovered').innerHTML = totalRecovered
            // numero totale di morti in tutte le regioni
            let totalDeath = lastUpdatedData.map(el => el.deceduti).reduce((t , n) => t + n)
            document.querySelector('#totalDeath').innerHTML = totalDeath
            // numero totale di attuali positivi in tutte le regioni
            let totalPositive = lastUpdatedData.map(el => el.totale_positivi).reduce((t , n) => t + n)
            document.querySelector('#totalPositive').innerHTML = totalPositive
            let cardWrapper = document.querySelector('#cardWrapper')
            let progressWrapper = document.querySelector('#progressWrapper')
            // variabile che mi da il max delle regione sui nuovi positivi
            let todayMax = Math.max(...lastUpdatedData.map(el => el.nuovi_positivi))
            // wrapper delle card a sinistra ,  wrapper delle progress-bar a destra
            lastUpdatedData.forEach(el => {
                let div = document.createElement('div')
                div.classList.add('clo-12' , 'col-md-6' , 'my-4')
                div.innerHTML =
                ` <div class="card-custom p-3 mb-0 h-100"   data-region="${el.denominazione_regione}">
                    <p>${el.denominazione_regione}</p>
                    <p class="text-end h5 mb-0 text-main">${el.nuovi_positivi}</p>
                </div>`
                cardWrapper.appendChild(div)

                let bar = document.createElement('div')
                bar.classList.add('col-12' , 'mb-5')
                bar.innerHTML =
                ` <p class="mb-0">${el.denominazione_regione} : ${el.nuovi_positivi}</p>
                <div class="progress rounded-0">
                    <div class="progress-bar bg main" style="width: ${100 * el.nuovi_positivi / todayMax}%">
                    </div>
                </div>`
                progressWrapper.appendChild(bar)
            })

            //   codide per la modale info regioni
            // click su card e visual dati relativi a regione
            document.querySelectorAll('[data-region]').forEach(el => {
                el.addEventListener('click' , () => {
                    let region = el.dataset.region
                    modal.classList.add('active')
                    let dataAboutRegion = lastUpdatedData.filter(el => el.denominazione_regione == region)[0]

                    modalContent.innerHTML =
                                `<div class="container">
                                    <div class="row">
                                        <div class="col-12">
                                            <p class="h2 text-main">${dataAboutRegion.denominazione_regione}</p>
                                        </div>
                                        <div class="col-12">
                                            <p>Totale Casi : ${dataAboutRegion.totale_casi}</p>
                                            <p>Totale Nuovi Positivi : ${dataAboutRegion.nuovi_positivi}</p>
                                            <p>Totale Deceduti : ${dataAboutRegion.deceduti}</p>
                                            <p>Totale Dimessi : ${dataAboutRegion.dimessi_guariti}</p>
                                            <p>Totale Ricoverati con Sintomi : ${dataAboutRegion.ricoverati_con_sintomi}</p>
                                        </div>
                                    </div>
                                        <div class="row scrollable">
                                            <div class="col-12">
                                                <p class="mb-0 mt-5 text-main">Trend Nuovi Casi</p>
                                                <div id="trendNew" class="d-flex align-items-end plot"></div>
                                            </div>
                                            <div class="col-12">
                                                <p class="mb-0 mt-5 text-main">Trend Decessi</p>
                                                <div id="trendDeath" class="d-flex align-items-end plot"></div>
                                            </div>
                                            <div class="col-12">
                                                <p class="mb-0 mt-5 text-main">Trend Guariti</p>
                                                <div id="trendRecovered" class="d-flex align-items-end plot"></div>
                                            </div>
                                        </div>
                                </div>`
                    let trendData = sorted.map(el => el).filter(el => el.denominazione_regione == region).map(el =>[el.data,el.nuovi_positivi,el.deceduti,el.dimessi_guariti])

                    let maxNew = Math.max(...trendData.map(el => el[1]))
                    let maxDeath = Math.max(...trendData.map(el => el[2]))
                    let maxRecovered = Math.max(...trendData.map(el => el[3]))

                    let trendNew = document.querySelector('#trendNew')
                    let trendDeath = document.querySelector('#trendDeath')
                    let trendRecovered = document.querySelector('#trendRecovered')
                    trendData.forEach(el => {
                        let colNew = document.createElement('div')
                        colNew.classList.add('d-inline-block' , 'pin-new')
                        colNew.style.height = `${70 * el[1] / maxNew}%`
                        trendNew.appendChild(colNew)

                        let colDeath = document.createElement('div')
                        colDeath.classList.add('d-inline-block' , 'pin-death')
                        colDeath.style.height = `${70 * el[2] / maxDeath}%`
                        trendDeath.appendChild(colDeath)

                        let colRecovered = document.createElement('div')
                        colRecovered.classList.add('d-inline-block' , 'pin-recovered')
                        colRecovered.style.height = `${70 * el[3] / maxRecovered}%`
                        trendRecovered.appendChild(colRecovered)
                    })
                })
            })

            let mapTrigger = document.querySelector('#mapTrigger')
            mapTrigger.addEventListener('click' , () =>{
                modal.classList.add('active')
                modalContent.innerHTML =
                           `<div class="container margin-map-custom">
                                <div class="row">
                                    <div class="d-flex align-items-center justify-content-center" style="height: 80vh;">
                                     <?xml version="1.0" standalone="no"?>
                                        <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"
                                        "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">
                                        <svg version="1.0" xmlns="http://www.w3.org/2000/svg"
                                        width="500" height="300pt" viewBox="0 0 1095.000000 1280.000000"
                                        preserveAspectRatio="xMidYMid meet">
                                        <metadata>
                                        Created by potrace 1.15, written by Peter Selinger 2001-2017
                                        </metadata>
                                        <g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)"
                                        fill="#ffffff" stroke="none">
                                        <path id="PT" d="M4560 12779 c-83 -25 -213 -46 -365 -59 -257 -24 -319 -53 -387 -185
                                        l-42 -83 -56 4 c-114 10 -187 26 -253 56 -82 38 -105 33 -154 -30 -25 -34 -33
                                        -53 -33 -86 0 -71 65 -236 120 -305 l32 -39 -15 -99 c-9 -54 -19 -134 -22
                                        -178 -4 -44 -15 -122 -26 -174 -38 -187 -35 -285 11 -326 19 -17 22 -17 76 4
                                        84 32 126 28 172 -14 22 -19 43 -49 48 -67 6 -20 22 -39 42 -51 73 -43 161 15
                                        219 143 39 87 97 151 167 187 40 20 66 25 130 27 l81 1 12 47 c16 65 17 66 92
                                        99 36 17 72 37 79 46 21 29 13 69 -29 149 l-42 78 6 93 c4 51 12 104 19 117 7
                                        13 40 44 73 69 45 32 69 59 90 100 17 31 35 59 42 61 6 3 33 -2 60 -10 64 -20
                                        185 -14 213 11 24 22 21 27 -67 130 -105 122 -138 169 -168 240 -31 73 -29 72
                                        -125 44z"/>
                                        <path id="PB" d="M4560 12779 c-83 -25 -213 -46 -365 -59 -257 -24 -319 -53 -387 -185
                                        l-42 -83 -56 4 c-114 10 -187 26 -253 56 -82 38 -105 33 -154 -30 -25 -34 -33
                                        -53 -33 -86 0 -71 65 -236 120 -305 l32 -39 -15 -99 c-9 -54 -19 -134 -22"/>
                                        <path id="VE" d="M5025 12311 c-22 -5 -67 -16 -100 -25 -32 -9 -86 -16 -120 -16 -33
                                        -1 -77 -7 -97 -14 -49 -17 -181 -119 -199 -153 -8 -16 -14 -56 -14 -102 0 -72
                                        2 -80 43 -145 48 -79 50 -96 22 -160 -21 -49 -57 -78 -123 -98 -47 -14 -75
                                        -48 -83 -99 -11 -70 -21 -75 -98 -55 l-67 17 -49 -27 c-27 -15 -73 -48 -103
                                        -75 -47 -41 -61 -63 -97 -149 -25 -59 -53 -108 -68 -120 -33 -27 -111 -26
                                        -224 2 l-88 21 -23 -21 c-61 -57 -78 -223 -37 -355 27 -86 59 -119 234 -242
                                        145 -102 173 -122 271 -200 91 -72 254 -155 305 -155 21 0 69 12 106 27 61 23
                                        84 26 194 27 147 1 234 -15 293 -55 69 -47 127 -35 127 26 0 36 -13 55 -113
                                        162 -42 46 -46 55 -37 74 7 11 16 64 21 116 16 172 60 233 282 387 143 100
                                        180 137 198 197 7 23 19 43 26 46 25 10 58 -7 75 -37 30 -53 68 -26 53 38 -13
                                        60 -108 142 -165 142 -11 0 -47 -11 -80 -25 -33 -14 -70 -25 -82 -25 -36 0
                                        -101 42 -123 79 -11 18 -39 55 -62 82 -24 27 -46 61 -49 74 -9 35 3 91 32 147
                                        l25 49 -54 57 c-120 127 -112 159 99 386 65 70 132 143 147 162 l29 34 -35 0
                                        c-19 0 -61 2 -93 4 -32 3 -77 1 -99 -3z"/>
                                        <path id="FR" d="M5341 12260 c-23 -6 -51 -27 -90 -69 -31 -33 -85 -83 -121 -111 -72
                                        -57 -100 -88 -153 -171 l-36 -56 41 -39 c75 -73 94 -144 59 -232 -24 -61 -19
                                        -85 33 -155 75 -101 76 -101 248 -98 82 1 158 -1 169 -4 11 -4 28 -24 39 -45
                                        27 -52 46 -61 94 -45 76 26 112 27 220 5 59 -12 115 -19 125 -15 14 4 20 19
                                        24 65 4 33 16 85 28 117 11 32 23 65 26 74 3 11 -8 21 -37 34 -81 37 -83 68
                                        -7 169 26 36 45 71 42 79 -8 20 -70 47 -111 47 -19 0 -44 5 -55 10 -25 14 -49
                                        62 -49 100 0 37 57 101 189 213 l84 72 -44 7 c-87 15 -345 38 -488 44 -80 3
                                        -157 6 -171 8 -14 2 -40 0 -59 -4z"/>
                                        <path id="LO" d="M2968 12220 c-21 -13 -32 -61 -24 -104 3 -17 24 -52 46 -76 45 -50
                                        45 -49 25 -76 -20 -26 -19 -58 5 -105 22 -42 19 -59 -19 -93 -30 -27 -77 -25
                                        -107 6 -14 13 -35 53 -47 89 -15 43 -28 65 -40 67 -10 2 -66 -17 -124 -43 -72
                                        -32 -112 -45 -129 -41 -38 10 -90 62 -130 131 -59 101 -80 97 -109 -23 -18
                                        -77 -55 -159 -129 -287 -52 -90 -71 -150 -81 -250 -9 -95 -21 -130 -51 -144
                                        -57 -25 -104 -4 -104 48 0 37 -47 106 -87 128 -33 17 -35 17 -71 -2 -51 -27
                                        -96 -111 -96 -180 -1 -40 8 -67 40 -130 23 -44 53 -111 68 -150 14 -38 48
                                        -108 75 -155 58 -98 59 -93 -33 -187 -41 -42 -70 -63 -85 -63 -14 0 -47 20
                                        -77 46 -30 25 -54 40 -54 32 0 -39 45 -189 75 -256 51 -110 66 -123 136 -120
                                        79 3 114 -24 261 -199 120 -144 152 -169 183 -143 11 9 15 36 15 109 0 107 11
                                        137 78 219 57 70 157 109 208 81 21 -11 37 -11 97 0 40 8 97 16 128 18 53 5
                                        57 4 80 -26 69 -91 69 -91 164 -110 50 -11 133 -36 185 -56 110 -43 146 -43
                                        212 2 l43 29 55 -25 c46 -22 73 -27 165 -29 61 -2 162 -1 225 3 l115 7 -45 40
                                        c-25 22 -95 73 -155 113 -170 113 -376 335 -413 444 -7 19 -12 69 -12 111 0
                                        86 17 144 74 257 20 40 36 79 36 88 0 21 -31 19 -113 -7 l-69 -23 -24 28 c-62
                                        72 -87 294 -42 380 18 35 23 68 30 202 4 88 13 174 19 192 21 65 -4 90 -176
                                        176 -117 58 -169 74 -197 57z"/>
                                        <path id="PI" d="M1449 11964 c-35 -30 -81 -70 -101 -88 l-38 -33 15 -51 c21 -69 11
                                        -91 -113 -250 -55 -70 -107 -141 -116 -159 -21 -43 -20 -90 5 -199 24 -105 17
                                        -153 -29 -199 -46 -47 -86 -58 -242 -65 -126 -7 -155 -11 -220 -37 -141 -55
                                        -190 -102 -190 -181 0 -72 -58 -168 -123 -206 -23 -14 -91 -41 -150 -62 -60
                                        -20 -118 -45 -130 -55 l-22 -17 24 -69 c48 -139 69 -172 123 -201 79 -43 109
                                        -72 139 -137 26 -57 33 -84 30 -113 0 -7 -44 -57 -96 -111 l-95 -98 24 -49
                                        c14 -27 30 -78 35 -112 18 -115 88 -196 226 -262 103 -49 194 -66 290 -52 111
                                        16 143 15 210 -8 117 -40 237 -18 250 47 3 15 24 73 46 128 23 55 55 135 73
                                        177 36 89 35 89 189 108 81 10 156 30 233 61 28 11 38 10 88 -10 53 -22 57
                                        -22 81 -7 14 9 34 34 45 57 45 88 87 99 178 48 73 -41 96 -37 100 19 4 53 -37
                                        133 -131 256 -103 135 -144 172 -205 185 -29 6 -68 11 -87 11 -33 0 -36 3 -74
                                        78 -78 155 -117 304 -92 351 10 19 20 21 85 20 72 -1 103 8 139 39 25 22 21
                                        54 -17 124 -19 35 -46 95 -61 133 -14 39 -41 98 -60 133 -29 51 -35 73 -35
                                        121 0 98 43 212 121 317 l38 52 -69 21 c-70 22 -74 25 -125 104 -50 76 -64
                                        116 -76 206 -6 50 -15 91 -19 91 -4 0 -36 -25 -71 -56z"/>
                                        <path id="VA" d="M810 11423 c-14 -2 -77 -17 -140 -33 -63 -16 -180 -41 -260 -55 -125
                                        -22 -197 -38 -272 -62 -10 -3 -18 -8 -18 -12 0 -3 21 -31 46 -61 57 -70 102
                                        -156 114 -223 17 -89 33 -92 250 -47 177 37 305 57 429 66 l94 7 -7 109 c-8
                                        126 -26 195 -63 238 -41 49 -117 81 -173 73z"/>
                                        <path id="EM" d="M2772 10300 c-47 -29 -128 -36 -176 -16 -71 30 -129 16 -180 -44 -36
                                        -44 -54 -112 -67 -263 -6 -71 -15 -140 -19 -153 -5 -13 -32 -35 -62 -51 l-53
                                        -27 94 -18 c52 -10 105 -25 118 -34 28 -18 61 -68 69 -104 24 -105 93 -136
                                        199 -89 30 13 69 21 106 22 53 0 62 -3 97 -35 46 -42 101 -77 265 -172 65 -38
                                        150 -93 190 -122 66 -50 74 -54 126 -54 31 0 85 -7 119 -15 68 -16 133 -22
                                        148 -13 5 4 51 13 103 22 74 13 114 27 189 66 53 28 103 50 112 50 8 0 71 -23
                                        139 -50 68 -28 132 -50 143 -50 60 0 69 -32 43 -157 -19 -89 -13 -106 60 -183
                                        59 -61 160 -116 193 -106 10 3 33 32 52 64 18 31 42 72 53 90 10 18 35 41 56
                                        51 61 31 199 71 246 71 44 0 45 0 74 -59 32 -62 71 -101 103 -101 56 0 16 81
                                        -114 230 -233 268 -255 324 -298 755 -25 251 -29 281 -44 299 -12 16 -93 36
                                        -238 56 l-86 13 -68 -43 c-54 -34 -76 -42 -113 -42 -103 -1 -711 33 -778 43
                                        -79 11 -94 7 -132 -36 -21 -25 -28 -27 -70 -22 -25 3 -111 30 -191 60 -80 30
                                        -176 62 -213 72 -58 15 -71 23 -84 49 -35 70 -57 79 -111 46z"/>
                                        <path id="LI" d="M1989 9714 c-8 -9 -25 -38 -39 -63 -16 -29 -39 -53 -62 -66 -33 -18
                                        -41 -18 -70 -6 -60 24 -91 23 -193 -10 -60 -19 -131 -33 -178 -36 -75 -5 -78
                                        -7 -94 -37 -8 -17 -37 -69 -64 -116 -36 -63 -52 -106 -64 -164 -18 -95 -32
                                        -119 -87 -147 -42 -21 -78 -22 -189 -3 -35 6 -37 4 -64 -43 -16 -26 -54 -86
                                        -85 -133 -61 -91 -90 -143 -90 -160 0 -27 52 -30 139 -10 227 54 312 101 411
                                        230 128 167 183 231 286 332 203 199 245 222 358 199 175 -36 366 -118 627
                                        -269 137 -79 185 -102 227 -108 47 -6 52 -5 52 12 0 24 -216 237 -285 281 -99
                                        63 -95 58 -95 121 0 111 -41 142 -186 142 -88 0 -94 1 -143 35 -55 38 -91 44
                                        -112 19z"/>
                                        <path id="TO" d="M2760 9491 c-27 -11 -56 -35 -74 -63 -23 -35 -20 -40 111 -195 57
                                        -68 119 -145 136 -171 17 -26 56 -75 88 -109 73 -79 101 -139 144 -314 52
                                        -207 78 -283 160 -469 81 -181 90 -212 100 -345 8 -102 21 -131 65 -139 16 -3
                                        43 -8 59 -11 15 -4 42 -20 60 -37 26 -26 31 -38 31 -80 0 -65 11 -83 70 -113
                                        89 -45 226 -189 280 -295 54 -107 102 -140 198 -140 70 0 126 21 143 52 7 12
                                        15 47 18 77 6 52 9 57 61 100 78 63 84 74 91 173 4 51 13 97 21 110 9 13 39
                                        31 68 41 63 22 80 54 80 154 1 37 5 112 9 165 11 114 29 153 87 185 45 25 64
                                        40 64 52 0 5 -18 35 -40 67 -50 74 -52 111 -9 180 48 75 109 200 109 223 0 26
                                        -19 35 -100 50 -83 16 -251 96 -313 151 -62 55 -87 105 -87 172 0 50 -2 54
                                        -50 99 -127 119 -182 133 -281 73 -113 -68 -262 -102 -372 -84 -56 9 -110 31
                                        -122 50 -10 16 -41 12 -79 -11 -42 -25 -34 -28 -233 103 -497 326 -469 309
                                        -493 299z"/>
                                        <path id="MA" d="M5389 8860 c-51 -82 -72 -93 -146 -74 -59 15 -95 30 -171 74 -52 29
                                        -55 29 -90 14 -51 -21 -100 -62 -126 -106 -28 -49 -17 -59 76 -66 114 -7 133
                                        -36 73 -111 -40 -50 -41 -73 -5 -81 14 -3 41 -17 60 -32 47 -36 180 -100 263
                                        -128 102 -33 114 -53 197 -330 28 -94 61 -193 75 -220 38 -75 126 -139 221
                                        -160 61 -14 66 -18 109 -95 19 -35 47 -78 61 -94 31 -37 42 -33 124 43 35 33
                                        80 63 125 82 192 81 202 92 180 198 -32 153 -132 409 -211 541 -70 116 -104
                                        147 -317 288 -111 75 -257 178 -324 231 -67 53 -124 96 -127 96 -2 0 -24 -31
                                        -47 -70z"/>
                                        <path id="UM" d="M4901 8401 c-12 -12 -21 -34 -21 -52 0 -17 -8 -47 -17 -66 -16 -35
                                        -16 -36 16 -95 43 -77 38 -98 -32 -135 -70 -38 -93 -84 -113 -234 -8 -63 -22
                                        -151 -30 -195 -15 -84 -14 -94 21 -154 8 -14 15 -34 15 -45 0 -35 28 -64 68
                                        -71 102 -17 107 -20 172 -109 44 -62 73 -91 103 -106 23 -11 67 -47 98 -80 70
                                        -73 89 -75 120 -11 40 78 195 200 355 277 177 86 246 162 179 199 -11 6 -39
                                        28 -63 48 -26 22 -60 40 -81 44 -58 9 -90 25 -111 54 -11 16 -38 90 -60 167
                                        -49 171 -94 295 -126 351 -28 48 -96 102 -128 102 -12 0 -31 7 -42 15 -28 19
                                        -230 101 -271 110 -25 5 -36 2 -52 -14z"/>
                                        <path id="AB" d="M6350 7563 c-208 -122 -251 -158 -298 -248 -25 -49 -54 -76 -112
                                        -105 -64 -32 -80 -49 -80 -84 0 -52 36 -151 91 -253 79 -148 80 -149 73 -167
                                        -11 -30 -66 -49 -148 -53 -82 -3 -106 -13 -106 -42 0 -22 26 -46 121 -109 41
                                        -27 118 -83 170 -124 142 -110 140 -110 233 -112 70 -2 95 -8 181 -44 136 -58
                                        162 -61 204 -26 18 15 59 66 91 114 60 89 100 130 128 130 8 0 49 -16 92 -35
                                        116 -52 131 -54 165 -13 46 54 106 193 112 259 7 73 -7 98 -82 140 -76 43
                                        -253 198 -379 331 -124 132 -209 248 -286 390 -30 56 -59 103 -65 104 -5 1
                                        -53 -23 -105 -53z"/>
                                        <path id="LA" d="M4610 7476 c-6 -8 -18 -43 -26 -77 -11 -46 -31 -86 -78 -154 -91
                                        -131 -106 -164 -106 -231 0 -44 8 -73 40 -141 92 -196 152 -275 269 -350 119
                                        -77 223 -183 259 -265 26 -57 47 -80 195 -217 195 -181 234 -211 389 -303 65
                                        -38 141 -87 170 -109 29 -21 62 -39 73 -40 60 -3 350 -10 482 -12 196 -3 198
                                        -1 258 155 15 37 42 93 61 125 44 74 46 124 6 179 -75 104 -173 156 -302 161
                                        -64 3 -105 12 -168 35 -81 31 -83 32 -108 84 -37 78 -107 128 -219 158 -77 20
                                        -95 41 -95 115 0 98 43 126 177 114 l73 -6 -49 109 c-69 155 -93 230 -98 304
                                        -5 82 14 116 89 156 56 31 69 55 48 93 -16 32 -54 26 -118 -18 -32 -21 -94
                                        -57 -140 -79 -86 -43 -103 -55 -247 -167 -132 -104 -181 -136 -220 -142 -32
                                        -5 -39 -2 -78 42 -23 26 -68 67 -100 92 -31 24 -82 75 -111 112 -55 69 -71 79
                                        -161 100 -68 16 -95 45 -104 112 -4 30 -10 60 -15 67 -10 16 -31 15 -46 -2z"/>
                                        <path id="MO" d="M7378 6542 c-29 -12 -82 -66 -144 -149 -79 -106 -144 -183 -153 -183
                                        -4 0 -16 17 -25 39 -38 84 -111 131 -172 111 -46 -15 -87 -65 -74 -90 5 -10
                                        15 -20 22 -22 9 -3 -3 -25 -32 -62 -98 -124 -126 -184 -114 -244 10 -48 26
                                        -56 87 -44 62 12 139 -1 232 -40 91 -39 163 -58 219 -58 105 0 279 60 294 100
                                        4 11 3 54 -2 96 -11 84 -4 97 64 132 43 21 58 66 59 172 2 171 -60 251 -191
                                        249 -29 0 -61 -3 -70 -7z"/>
                                        <path id="PU" d="M8220 6469 c-330 -30 -429 -42 -458 -51 -51 -16 -64 -45 -72 -165 -7
                                        -116 -5 -113 -90 -166 -63 -40 -52 -83 53 -205 25 -30 48 -66 52 -80 11 -46
                                        34 -71 106 -117 l70 -45 -7 -63 c-5 -53 -3 -66 14 -87 26 -32 78 -37 337 -29
                                        295 9 330 0 355 -91 14 -53 41 -83 106 -120 31 -17 99 -73 151 -123 l94 -91
                                        86 29 c79 26 90 27 132 16 66 -18 98 -53 122 -136 45 -155 52 -175 70 -204 24
                                        -39 48 -39 103 -2 23 16 69 39 102 49 68 23 225 37 269 24 35 -10 44 -41 21
                                        -65 -58 -57 27 -91 324 -127 201 -25 230 -33 264 -67 38 -38 91 -136 115 -215
                                        27 -90 54 -140 98 -184 47 -47 147 -95 177 -85 32 12 71 101 107 241 l31 125
                                        -33 64 c-57 112 -333 378 -514 496 -100 66 -252 143 -327 165 -31 10 -148 72
                                        -260 138 -272 161 -308 177 -566 265 -423 145 -727 276 -796 343 -44 43 -75
                                        105 -76 150 0 38 37 95 133 206 93 107 98 120 60 160 -47 50 -73 58 -175 57
                                        -51 -1 -131 -5 -178 -10z"/>
                                        <path id="CA" d="M6791 5809 c-17 -24 -37 -54 -46 -66 -21 -31 -42 -29 -75 7 -38 40
                                        -57 31 -76 -39 -8 -31 -24 -83 -34 -117 -11 -33 -20 -72 -20 -85 0 -14 50
                                        -124 111 -245 l112 -219 111 -6 c61 -3 130 -12 154 -19 56 -17 116 -70 135
                                        -119 21 -50 53 -81 87 -81 15 0 60 11 100 25 40 14 82 25 92 25 30 0 114 -92
                                        151 -166 45 -90 63 -147 87 -273 22 -116 38 -148 78 -157 46 -11 94 -39 173
                                        -102 73 -58 128 -92 148 -92 5 0 31 17 58 39 27 21 71 48 98 60 28 12 63 34
                                        78 49 34 32 67 93 67 122 0 32 -34 92 -110 194 -37 50 -90 128 -116 171 -26
                                        44 -60 96 -76 115 -35 45 -95 175 -110 239 -15 66 -3 92 60 131 53 32 72 63
                                        72 115 0 57 -34 75 -165 90 -111 12 -174 70 -146 131 22 48 14 70 -39 109 -56
                                        41 -84 76 -94 119 -11 46 -36 76 -63 76 -14 0 -60 -15 -102 -34 -80 -35 -187
                                        -69 -253 -80 -30 -5 -63 4 -187 54 -83 33 -168 63 -190 66 -38 6 -40 4 -70
                                        -37z"/>
                                        <path id="SA"  d="M2272 5447 c-22 -49 -40 -72 -69 -90 -21 -14 -96 -80 -167 -146 -113
                                        -107 -142 -128 -232 -173 l-102 -51 -149 -9 c-90 -6 -161 -16 -180 -25 -67
                                        -31 -57 -86 46 -241 96 -145 92 -136 142 -274 41 -111 42 -116 46 -271 5 -157
                                        5 -158 -21 -195 -41 -60 -32 -95 35 -138 24 -15 46 -39 55 -59 28 -67 13 -196
                                        -36 -318 -47 -117 -72 -269 -68 -405 3 -111 5 -121 40 -194 76 -159 159 -252
                                        271 -304 51 -23 58 -24 89 -11 68 28 114 105 138 227 16 82 41 117 106 147 46
                                        21 67 25 123 21 57 -3 77 -10 138 -46 83 -49 135 -56 154 -21 27 50 93 522
                                        129 921 l21 227 -42 78 c-58 110 -55 141 39 323 40 76 72 149 72 162 0 68
                                        -137 365 -214 462 -25 33 -46 62 -46 66 0 3 7 15 15 26 21 28 19 38 -20 84
                                        -19 23 -35 47 -35 54 0 19 -90 115 -124 132 -17 9 -52 37 -78 61 l-47 46 -29
                                        -66z"/>
                                        <path id="BA" d="M8307 5406 c-91 -20 -116 -44 -152 -149 -9 -26 -36 -71 -59 -100 -88
                                        -107 -97 -157 -40 -209 20 -18 61 -73 91 -123 75 -122 133 -203 225 -314 60
                                        -73 78 -102 78 -125 0 -17 -16 -86 -36 -152 -52 -170 -39 -201 67 -170 93 28
                                        159 18 210 -30 43 -41 96 -42 171 -6 35 17 70 37 79 44 20 17 53 80 69 135 16
                                        53 29 64 110 93 35 13 81 39 100 57 45 40 111 178 118 243 4 42 -1 58 -36 122
                                        -22 40 -52 113 -66 162 -44 152 -62 164 -186 122 -42 -14 -84 -26 -91 -26 -8
                                        0 -63 41 -124 91 -103 84 -211 159 -231 159 -18 0 -64 52 -69 78 -13 63 -22
                                        78 -55 94 -40 21 -91 22 -173 4z"/>
                                        <path id="CL" d="M9066 4208 c-8 -13 -22 -52 -31 -88 -30 -120 -33 -127 -73 -143 -95
                                        -38 -238 -28 -370 24 -87 35 -118 37 -127 8 -20 -62 43 -247 176 -514 79 -161
                                        107 -228 139 -344 42 -145 77 -226 150 -346 22 -36 40 -72 40 -81 0 -22 -45
                                        -106 -77 -144 -17 -21 -62 -49 -120 -76 -110 -51 -124 -70 -105 -140 34 -128
                                        -11 -311 -107 -432 -61 -76 -81 -125 -81 -200 0 -76 21 -126 64 -154 27 -17
                                        43 -19 125 -14 153 9 214 52 241 168 18 77 82 206 130 261 24 26 63 59 89 71
                                        59 31 86 61 100 111 6 22 15 130 20 241 7 153 13 208 25 232 36 70 161 135
                                        370 194 l119 33 -6 120 c-12 224 -48 376 -105 436 -51 53 -186 131 -312 180
                                        -134 52 -173 74 -194 111 -28 47 -31 130 -7 242 28 130 28 205 0 240 -25 32
                                        -54 33 -73 4z"/>
                                        <path id="SI" d="M8236 1905 c-27 -19 -104 -66 -172 -105 l-124 -71 -187 -8 c-104 -5
                                        -199 -14 -213 -19 -14 -5 -36 -21 -48 -35 -54 -58 -162 -84 -497 -122 -121
                                        -13 -260 -34 -310 -46 -52 -12 -107 -19 -130 -16 -62 7 -149 44 -206 87 -35
                                        26 -73 44 -120 55 -63 16 -69 19 -79 51 -13 39 -40 50 -101 40 -71 -11 -119
                                        -37 -153 -82 -49 -64 -130 -124 -167 -124 -7 0 -43 18 -80 40 -82 49 -118 51
                                        -180 11 -110 -71 -139 -127 -139 -274 0 -130 8 -155 65 -191 25 -15 50 -36 55
                                        -46 11 -20 56 -33 198 -54 114 -17 277 -68 372 -116 33 -17 117 -68 185 -113
                                        319 -211 379 -239 675 -317 302 -80 317 -88 397 -206 118 -174 247 -234 505
                                        -238 105 -1 107 0 137 28 16 16 33 43 37 60 7 35 64 152 117 239 l35 59 -44
                                        93 c-24 51 -44 100 -44 109 0 9 -22 61 -50 115 -83 163 -83 165 -15 392 64
                                        216 59 206 163 379 139 232 215 402 199 443 -9 25 -26 21 -81 -18z"/>
                                        </g>
                                        </svg>
                                    </div>
                                </div>

                                        <div class="row my-0 mt-0">
                                            <div class="col-12 text-center text-main text-uppercase">
                                                <p id="label">NUOVI POSITIVI</p>
                                            </div>
                                        </div>
                                        <div class="row justify-content-center legend">
                                        <button id="nuovi_positivi" class="btn-circle switchMap mx-2">
                                            <i class="fas fa-plus text-main"></i>
                                        </button>
                                        <button id="totale_casi" class="btn-circle switchMap mx-2">
                                            <i class="fas fa-list text-main"></i>
                                        </button>
                                        <button id="totale_casi" class="btn-circle switchMap mx-2">
                                            <i class="fa-regular fa-skull text-main"></i>
                                        </button>
                                        <button id="dimessi_guariti" class="btn-circle switchMap mx-2">
                                            <i class="fas fa-walking text-main"></i>
                                        </button>
                                        <button id="terapia_intensiva" class="btn-circle switchMap mx-2">
                                            <i class="fas fa-heartbeat text-main"></i>
                                        </button>
                                        <button id="tamponi" class="btn-circle switchMap mx-2">
                                            <i class="fas fa-microscope text-main"></i>
                                        </button>
                                        <button id="totale_ospedalizzati" class="btn-circle switchMap mx-2">
                                            <i class="fas fa-hospital-user text-main"></i>
                                        </button>
                                        </div>
                            </div>`

                function colorMap(field){
                    let maxed = Math.max(...lastUpdatedData.map(el => el[field]))
                    document.querySelector('#label').innerHTML = field.replace(/_/g," ")


                    lastUpdatedData.forEach(el =>{
                        let id = document.querySelector(`#${el.code}`)
                        id.style.fill = `rgba(17,67,153,${el[field] / maxed})`
                    })
                }

                document.querySelectorAll('.switchMap').forEach(el => {
                         el.addEventListener('click' , () =>{
                             colorMap(el.id)
                         })
                     })

                     colorMap("nuovi_positivi")




                lastUpdatedData.forEach(el => {
                 let id = document.querySelector(`#${el.code}`)
                     id.style.fill = `rgba(17,67,153,${el.nuovi_positivi / (100 * 70)})`
                })
            })

            let pieTrigger = document.querySelector('#pieTrigger')
            pieTrigger.addEventListener('click' , () =>{
                modal.classList.add('active')

                let tempo = []
                for(i = 21; i >= 1; i--){
                    let color = `rgba(17,67,153,${(i / 21).toFixed(2)})`
                    tempo.push(color)
                }

                let maxed = lastUpdatedData.map(el => el.nuovi_positivi).reduce((t,n) => t + n)
                let final = lastUpdatedData.map((el,i) => [el.denominazione_regione,el.nuovi_positivi , tempo[i]]).sort()

                let start = 0
                let cumulative =[0,...final.map(el => start += +(360 * el[1] / maxed).toFixed(3))]

                let recapFinal = cumulative.map((el,i) => [cumulative[i] , cumulative[i+1]]).splice(0,cumulative.length -1).map((el,i) => [...el,...final[i]])

                let colorDegrees = recapFinal.map(el => [`${el[4]}${el[0]}deg ${el[1]}deg`,...el])

                let toShow = colorDegrees.map(el => el[0]).join(",")


                modalContent.innerHTML =
                        `<div class="container my-0 py-0">
                                <div class="row justify-content-center align-items-center">
                                    <div class="pieChart">
                                    </div>
                                </div>
                                <div id="legend" class="row my-5 py-5 scrollable">
                                </div>
                        </div>`
                    document.querySelector('.pieChart').style.background = `conic-gradient(${toShow})`

                    let legend = document.querySelector('#legend')
                    colorDegrees.forEach(el => {
                        let voice = document.createElement('div')
                        voice.classList.add('col-12' ,  'col-md-3' , 'my-3')
                        voice.innerHTML =
                                 `<p class="small my-3">
                                    ${el[3]} : ${el[4]}`
                            voice.style.borderLeft = `5px solid ${el[5]}`
                            legend.appendChild(voice)
                    })
                     })

            window.addEventListener('click',function(e){
                if(e.target == modal){
                    modal.classList.remove('active')
                }
            })
        })


    </script>
</body>
</html>
